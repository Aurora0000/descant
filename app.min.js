var app=angular.module("descant","ngAnimate ngRoute ngTagsInput relativeDate infinite-scroll descant.config descant.services.tokenservice descant.directives.authforms descant.directives.authmisc descant.directives.authstatus descant.directives.navbtn descant.directives.newpost descant.directives.newtopic descant.directives.taglist descant.directives.topiclist descant.directives.topicview descant.directives.topicview descant.directives.userlist descant.directives.userstats descant.directives.entropyindicator descant.filters.html".split(" "));
app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{title:"Home",templateUrl:"pages/topics.html"}).when("/topics",{title:"Topics",templateUrl:"pages/topics.html"}).when("/users",{title:"Users",templateUrl:"pages/users.html"}).when("/admin",{title:"Administration",templateUrl:"pages/admin.html"}).when("/topic/:topicId",{title:"Topic",templateUrl:"pages/post-view.html",controller:"PostViewController"}).when("/topics/:tagId",{title:"Topics",templateUrl:"pages/tag-topics.html",
controller:"TagTopicViewController"}).when("/user/:userId",{title:"User Information",templateUrl:"pages/user-view.html",controller:"UserViewController"}).when("/chat",{title:"Chat",templateUrl:"pages/chat.html"}).when("/login",{title:"Log in",templateUrl:"pages/login.html"}).when("/register",{title:"Register",templateUrl:"pages/register.html"}).when("/logout",{title:"Log out",templateUrl:"pages/logout.html"}).when("/activate",{title:"Account Activation",template:"",controller:"ActivateController"}).when("/registered",
{title:"Registration Succeeded!",templateUrl:"pages/registration-done.html"}).when("/404",{title:"Not Found",templateUrl:"pages/404.html"}).otherwise("/404")}]);app.directive("chatBox",function(){return{restrict:"E",templateUrl:"templates/chat/chat-box.html"}});app.directive("adminPanel",function(){return{restrict:"E",templateUrl:"templates/admin/admin-panel.html"}});
app.run(["$rootScope","$route","$timeout","$window","descantConfig",function(a,b,c,d,g){a.$on("$routeChangeSuccess",function(){c(function(){d.scrollTo(0,0)},500);document.title=b.current.title+" | "+g.forumName})}]);angular.module("descant.config",["ngResource"]).config(["$resourceProvider",function(a){a.defaults.stripTrailingSlashes=!1}]).constant("descantConfig",{backend:"//django-descant.rhcloud.com",version:.1,forumName:"Descant Demo Forum"});
var tagApp=angular.module("descant.services.tagservice",["descant.config","ngResource"]);tagApp.factory("Tag",["$resource","$cacheFactory","descantConfig",function(a,b,c){return a(c.backend+"/api/v0.1/tags/",{},{query:{method:"GET",cache:!0,isArray:!0}})}]);tagApp.service("tagService",["$http","$q","$rootScope","descantConfig","Tag",function(a,b,c,d,g){this.tags=[];this.getTagInfo=function(a){return g.query().$promise.then(function(b){return b[a-1]})};this.getAllTags=function(){return this.tags=g.query()}}]);
var tokenApp=angular.module("descant.services.tokenservice",["descant.config","LocalStorageModule"]);
tokenApp.service("tokenService",["$http","$q","$rootScope","descantConfig","localStorageService",function(a,b,c,d,g){this.authenticated=!1;this.token="";this.login=function(f,h){this.authenticated=!1;this.token="";var e=this,k=a.post(d.backend+"/api/auth/login/",{username:f,password:h});k.then(function(a){e.token=a.data.auth_token;e.authenticated=!0;g.set("authToken",e.token);e.setHeader();c.$broadcast("auth:statusChange");return a},function(a){e.token="";e.authenticated=!1;g.remove("authToken");
return b.reject(a)});return k};this.logout=function(){var f=a.post(d.backend+"/api/auth/logout/",{}),h=this;f.then(function(a){h.authenticated=!1;h.token="";g.remove("authToken");h.setHeader();c.$broadcast("auth:statusChange");return a},function(a){h.authenticated=!0;return b.reject(a)});return f};this.getToken=function(){if(this.authenticated)return this.token;var a=g.get("authToken");return null!=a?(this.authenticated=!0,this.token=a):!1};this.setHeader=function(){var b=this.getToken();a.defaults.headers.common.Authorization=
0!=b?"Token "+b:null};this.purgeToken=function(){g.remove("authToken")};this.getAuthStatus=function(){if(this.loaded&&!this.error)return b(function(a,b){a(this.user)});var c=a.get(d.backend+"/api/auth/me/"),g=this;c.then(function(a){g.user=a;g.loaded=!0;g.error=!1;return a},function(a){g.loaded=!0;g.error=!0;return b.reject(a)});return c}}]);var authFormApp=angular.module("descant.directives.authforms",["descant.config","descant.services.tokenservice"]);
authFormApp.directive("loginBox",["tokenService","$location",function(a,b){return{restrict:"E",templateUrl:"templates/users/login-box.html",controller:function(){this.login=function(c,d){a.login(c,d).then(function(a){b.path("/")},function(a){alert("Invalid user/password!")})}},controllerAs:"loginCtrl"}}]);
authFormApp.directive("registerBox",["$location",function(a){return{restrict:"E",templateUrl:"templates/users/register-box.html",controller:["$http","descantConfig",function(b,c){this.register=function(d,g,f){d=b.post(c.backend+"/api/auth/register/",{email:g,username:d,password:f});d.success(function(b){a.path("/registered")});d.error(function(a){alert("There was an error while trying to register.")})}}],controllerAs:"registerCtrl"}}]);
var authMiscApp=angular.module("descant.directives.authmisc",["descant.services.tokenservice"]);authMiscApp.directive("logout",["tokenService","$location",function(a,b){return{restrict:"E",template:"",controller:function(b){a.logout().then(function(a){b.path("/")},function(b){alert("Cannot log out.");a.purgeToken()})}}}]);authMiscApp.directive("emitToken",["tokenService",function(a){return{restrict:"E",template:"",controller:function(){a.setHeader()}}}]);
var authApp=angular.module("descant.directives.authstatus",["descant.config","descant.services.tokenservice"]);
authApp.directive("authStatus",["$http","tokenService","descantConfig",function(a,b,c){return{restrict:"E",templateUrl:"templates/users/auth-status.html",controller:["$http","$scope","tokenService",function(a,b,c){this.tryAuth=function(){var a=this;c.getAuthStatus().then(function(b){a.user=b.data;a.error=!1},function(b){a.error=!0})};b.tokenServ=c;var h=this;b.$on("auth:statusChange",function(a,b){c.loaded=!1;h.tryAuth()});h.tryAuth()}],controllerAs:"auth"}}]);
var entropyApp=angular.module("descant.directives.entropyindicator",[]);
entropyApp.directive("entropyIndicator",function(){return{restrict:"E",scope:{password:"=",percentage:"="},templateUrl:"templates/users/password-entropy-indicator.html",controller:["$scope",function(a){a.$watch("password",function(b,c){if(null!=a.password){Math.log2=Math.log2||function(a){return Math.log(a)/Math.LN2};var d=0;/\d/.test(a.password)&&(d+=10);/[a-z]/.test(a.password)&&(d+=26);/[A-Z]/.test(a.password)&&(d+=26);/\W/.test(a.password)&&(d+=32);d=Math.log2(d);a.entropy=d*a.password.length;
a.percentage=a.entropy-20;20>a.entropy?a.percentage=0:120<a.entropy&&(a.percentage=100)}})}],controllerAs:"navCtrl"}});var navApp=angular.module("descant.directives.navbtn",[]);navApp.directive("navBtn",function(){return{restrict:"E",require:"^routeUrl",scope:{routeUrl:"@",routeName:"@",routeIcon:"@"},templateUrl:"templates/nav/nav-btn.html",controller:["$scope","$location",function(a,b){a.isActive=function(a){return a===b.path()}}],controllerAs:"navCtrl"}});
var newPostApp=angular.module("descant.directives.newpost",["descant.config","descant.services.tokenservice"]);
newPostApp.directive("newPostBox",["$location",function(a){return{restrict:"E",templateUrl:"templates/posts/new-post-box.html",scope:{postData:"="},controller:["tokenService","$rootScope","$scope","$http","descantConfig",function(b,c,d,g,f){this.submitting=!1;this.auth=b.authenticated;var h=this;c.$on("auth:statusChange",function(){h.auth=b.authenticated});this.showNTP=!1;this.toggleNTP=function(){this.showNTP=1==this.showNTP?!1:!0};this.addReply=function(b){this.submitting=!0;var h=this;g.post(f.backend+
"/api/v0.1/topics/"+d.postData.id+"/replies/",{contents:b}).success(function(b){h.submitting=!1;a.path("/topic/"+d.postData.id);h.toggleNTP();c.$broadcast("topic:refresh")}).error(function(a){h.submitting=!1;alert("Error!")})}}],controllerAs:"newPostCtrl"}}]);var newTopicApp=angular.module("descant.directives.newtopic",["descant.config","descant.services.tokenservice"]);
newTopicApp.directive("newTopicBox",["$location",function(a){return{restrict:"E",templateUrl:"templates/topics/new-topic-box.html",controller:["tokenService","tagService","$rootScope","$http","descantConfig",function(b,c,d,g,f){this.auth=b.authenticated;this.submitting=!1;var h=this;d.$on("auth:statusChange",function(){h.auth=b.authenticated});this.showNTP=!1;this.toggleNTP=function(){this.showNTP=1==this.showNTP?!1:!0};this.addTopic=function(b,c,l){this.submitting=!0;var h;for(h=0;h<l.length;h++)l[h]=
parseInt(l[h].id);var m=this;g.post(f.backend+"/api/v0.1/topics/",{title:b,contents:c,tag_ids:l}).success(function(b){m.submitting=!1;a.path("/topics");m.toggleNTP();d.$broadcast("topics:refresh")}).error(function(a){m.submitting=!1;alert("Error!")})};this.loadTags=function(){return c.getAllTags().$promise}}],controllerAs:"newTopicCtrl"}}]);tagApp=angular.module("descant.directives.taglist",["descant.config","descant.services.tagservice"]);
tagApp.directive("tagList",["$location","tagService",function(a,b){return{restrict:"E",templateUrl:"templates/topics/tag-list.html",controller:["$rootScope","$http","descantConfig",function(a,d,g){this.showTags=!1;this.toggleBox=function(){this.showTags=1==this.showTags?!1:!0};var f=this;this.updateList=function(){f.list=b.getAllTags()};this.updateList()}],controllerAs:"tagCtrl"}}]);var topicListApp=angular.module("descant.directives.topiclist",["descant.config"]);
topicListApp.directive("topicList",["descantConfig",function(a){return{restrict:"E",templateUrl:"templates/topics/topic-list.html",scope:{url:"@"},controller:["$http","$scope","$interval","$rootScope",function(b,c,d,g){var f=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!f.busy&&!f.end){f.busy=!0;var d=b.get(a.backend+c.url+"?limit="+f.limit.toString()+"&offset="+f.offset.toString());d.success(function(a){if(0==a.results.length)f.end=!0;else{for(var b=
a.results,c=0;c<b.length;c++)f.list.push(b[c]);f.offset+=a.results.length;f.busy=!1}});d.error(function(a){f.busy=!1;f.end=!0})}};this.refreshList=function(){f.busy=!0;f.end=!1;var d=b.get(a.backend+c.url+"?limit="+f.offset.toString()+"&offset=0");d.success(function(a){0==a.results.length?f.end=!0:(f.list=a.results,f.busy=!1)});d.error(function(a){f.busy=!1;f.end=!0})};this.stopRefreshList=d(this.refreshList,45E3);g.$on("topics:refresh",function(){f.refreshList()});g.$on("$destroy",function(){d.cancel(f.stopRefreshList)})}],
controllerAs:"topics"}}]);var topicTagsApp=angular.module("angular.directives.topictags",["descant.services.tagservice"]);tagApp.directive("topicTags",["tagService",function(a){return{restrict:"E",templateUrl:"templates/topics/topic-tags.html",scope:{tagItems:"="},controller:["$scope",function(b){this.tags=[];this.updateTags=function(){var c;for(c=0;c<b.tagItems.length;c++){var d=this;a.getTagInfo(parseInt(b.tagItems[c])).then(function(a){null!=a&&d.tags.push(a)})}};this.updateTags()}],controllerAs:"tags"}}]);
var topicViewApp=angular.module("descant.directives.topicview",["descant.config","descant.filters.html"]);
topicViewApp.directive("topicFirstpost",["descantConfig",function(a){return{restrict:"E",templateUrl:"templates/topics/topic-firstpost.html",scope:{postData:"=",topicId:"="},controller:["$http","$scope","$location","$route","tagService","tokenService",function(b,c,d,g,f,h){this.editing=!1;var e=this;e.loaded=!1;var k=b.get(a.backend+"/api/v0.1/topics/"+c.topicId+"/");k.success(function(b){e.post=b;c.postData=b;e.loaded=!0;document.title=e.post.title+" | "+a.forumName;c.user=null!=h.user?h.user.data.id:
-1});k.error(function(a){e.loaded=!0;e.error=!0});this.lock=function(){b.put(a.backend+"/api/v0.1/topics/"+c.topicId+"/",{title:e.post.title,contents:e.post.contents,tag_ids:e.post.tag_ids,is_locked:!0}).success(function(){g.reload()})};this.unlock=function(){b.put(a.backend+"/api/v0.1/topics/"+c.topicId+"/",{title:e.post.title,contents:e.post.contents,tag_ids:e.post.tag_ids,is_locked:!1}).success(function(){g.reload()})};this.edit=function(){this.editing=!this.editing;c.tag_ids_edited=[];c.contents_edited=
e.post.contents;c.title_edited=e.post.title;for(var a=0;a<e.post.tag_ids;a++)f.getTagInfo(e.post.tag_ids[a]).then(function(a){null!=a&&c.tag_ids_edited.push(a)})};this.editSubmit=function(){for(var d=c.tag_ids_edited,f=0;f<d.length;f++)d[f]=parseInt(d[f].id);var e=this;b.put(a.backend+"/api/v0.1/topics/"+c.topicId+"/",{title:c.title_edited,contents:c.contents_edited,tag_ids:d}).success(function(a){e.edit()})};this.deleteObj=function(){b["delete"](a.backend+"/api/v0.1/topics/"+c.topicId+"/").success(function(a){d.path("/")})};
this.loadTags=function(){return f.getAllTags()}}],controllerAs:"topic"}}]);
topicViewApp.directive("replyItem",function(){return{restrict:"E",templateUrl:"templates/posts/reply-item.html",scope:{post:"="},controller:["$http","$scope","$route","descantConfig","tokenService",function(a,b,c,d,g){this.editing=!1;b.user=null!=g.user?g.user.data.id:-1;this.edit=function(){b.contents_edited=b.post.contents;this.editing=!this.editing};this.editSubmit=function(){a.put(d.backend+"/api/v0.1/posts/"+b.post.id+"/",{contents:b.contents_edited}).success(function(a){c.reload()})};this.deleteObj=
function(){var f=a["delete"](d.backend+"/api/v0.1/posts/"+b.post.id+"/");f.success(function(a){c.reload()});f.error(function(a){alert("Unexpected error!")})}}],controllerAs:"postCtrl"}});
topicViewApp.directive("postList",["descantConfig",function(a){return{restrict:"E",templateUrl:"templates/posts/reply-list.html",scope:{url:"@"},controller:["$http","$interval","$route","$rootScope","$scope","tokenService",function(b,c,d,g,f,h){var e=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!e.busy&&!e.end){e.busy=!0;var c=b.get(a.backend+f.url+"?limit="+e.limit.toString()+"&offset="+e.offset.toString());c.success(function(a){if(0==a.results.length)e.end=
!0;else{for(var b=a.results,c=0;c<b.length;c++)e.list.push(b[c]);e.offset+=a.results.length;e.busy=!1}});c.error(function(a){e.busy=!1;e.end=!0})}};this.refreshList=function(){e.busy=!0;e.end=!1;var c=b.get(a.backend+f.url+"?limit="+e.offset.toString()+"&offset=0");c.success(function(a){0==a.results.length?e.end=!0:(e.list=a.results,e.busy=!1)});c.error(function(a){e.busy=!1;e.end=!0})};this.stopRefreshList=c(this.refreshList,45E3);g.$on("topic:refresh",function(){e.refreshList()});this.destroy=function(){c.cancel(e.stopRefreshList)};
g.$on("$destroy",function(){e.destroy()});g.$on("$locationChangeSuccess",function(){e.destroy()})}],controllerAs:"posts"}}]);var userListApp=angular.module("descant.directives.userlist",["descant.config"]);
userListApp.directive("userList",["descantConfig",function(a){return{restrict:"E",templateUrl:"templates/users/user-list.html",controller:["$http",function(b){var c=this;b=b.get(a.backend+"/api/v0.1/users/");b.success(function(a){c.list=a;c.loaded=!0});b.error(function(a){c.loaded=!0;c.error=!0})}],controllerAs:"users"}}]);var userStatsApp=angular.module("descant.directives.userstats",["descant.config"]);
userListApp.directive("userStats",["descantConfig",function(a){return{restrict:"E",scope:{userId:"@"},templateUrl:"templates/users/user-stats.html",controller:["$http","$scope",function(b,c){var d=this,g=b.get(a.backend+"/api/v0.1/users/"+c.userId+"/");g.success(function(a){d.user=a;d.loaded=!0});g.error(function(a){d.loaded=!0;d.error=!0})}],controllerAs:"userCtrl"}}]);var controllerApp=angular.module("descant.controllers.routing",["descant.config"]);
app.controller("PostViewController",["$scope","$routeParams",function(a,b){a.topicId=b.topicId}]);app.controller("UserViewController",["$scope","$location","$routeParams",function(a,b,c){-1!=c.userId?a.userId=c.userId:b.path("/users")}]);app.controller("TagTopicViewController",["$scope","$routeParams",function(a,b){a.tagId=b.tagId}]);
app.controller("ActivateController",["$http","descantConfig","$location","$routeParams",function(a,b,c,d){a=a.post(b.backend+"/api/auth/activate/",{uid:d.uid,token:d.token});a.success(function(a){c.path("/login")});a.error(function(a){alert("Error while activating account!")})}]);var htmlApp=angular.module("descant.filters.html",[]);app.filter("html",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]);
