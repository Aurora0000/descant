var app=angular.module("descant","ngAnimate ngRoute ngTagsInput relativeDate infinite-scroll descant.config descant.services.tokenservice descant.directives.authforms descant.directives.authmisc descant.directives.authstatus descant.directives.navbtn descant.directives.newpost descant.directives.newtopic descant.directives.taglist descant.directives.topiclist descant.directives.topicview descant.directives.topicview descant.directives.userlist descant.directives.userstats descant.filters.html".split(" "));
app.config(["$routeProvider","$locationProvider",function(c,d){c.when("/",{title:"Home",templateUrl:"pages/topics.html"}).when("/topics",{title:"Topics",templateUrl:"pages/topics.html"}).when("/users",{title:"Users",templateUrl:"pages/users.html"}).when("/admin",{title:"Administration",templateUrl:"pages/admin.html"}).when("/topic/:topicId",{title:"Topic",templateUrl:"pages/post-view.html",controller:"PostViewController"}).when("/topics/:tagId",{title:"Topics",templateUrl:"pages/tag-topics.html",
controller:"TagTopicViewController"}).when("/user/:userId",{title:"User Information",templateUrl:"pages/user-view.html",controller:"UserViewController"}).when("/chat",{title:"Chat",templateUrl:"pages/chat.html"}).when("/login",{title:"Log in",templateUrl:"pages/login.html"}).when("/register",{title:"Register",templateUrl:"pages/register.html"}).when("/logout",{title:"Log out",templateUrl:"pages/logout.html"}).when("/activate",{title:"Account Activation",template:"",controller:"ActivateController"}).when("/registered",
{title:"Registration Succeeded!",templateUrl:"pages/registration-done.html"}).when("/404",{title:"Not Found",templateUrl:"pages/404.html"}).otherwise("/404")}]);app.directive("chatBox",function(){return{restrict:"E",templateUrl:"templates/chat/chat-box.html"}});app.directive("adminPanel",function(){return{restrict:"E",templateUrl:"templates/admin/admin-panel.html"}});
app.run(["$rootScope","$route","$timeout","$window","descantConfig",function(c,d,b,e,f){c.$on("$routeChangeSuccess",function(){b(function(){e.scrollTo(0,0)},500);document.title=d.current.title+" | "+f.forumName})}]);angular.module("descant.config",[]).constant("descantConfig",{backend:"//django-descant.rhcloud.com",version:.1,forumName:"Descant Demo Forum"});var tagApp=angular.module("descant.services.tagservice",["descant.config"]);
tagApp.service("tagService",["$http","$q","$rootScope","descantConfig",function(c,d,b,e){this.tags=[];this.fetched=!1;this.getTagInfo=function(c){var a=this;if(0==this.fetched)return this.fetch().then(function(d){return a.tags[c-1]});var b=this.tags[c-1];return d(function(a,c){a(b)})};this.getAllTags=function(){if(0==this.fetched){var c=this;return this.fetch().then(function(a){return c.tags})}var a=this.tags;return d(function(c,d){c(a)})};this.fetch=function(){var b=this;return c.get(e.backend+"/api/v0.1/tags/").then(function(a){b.tags=
a.data;b.fetched=!0;return a.data},function(a){b.fetched=!0;return d.reject(a)})}}]);var tokenApp=angular.module("descant.services.tokenservice",["descant.config","LocalStorageModule"]);
tokenApp.service("tokenService",["$http","$q","$rootScope","descantConfig","localStorageService",function(c,d,b,e,f){this.authenticated=!1;this.token="";this.login=function(a,g){this.authenticated=!1;this.token="";var h=this,k=c.post(e.backend+"/api/auth/login/",{username:a,password:g});k.then(function(a){h.token=a.data.auth_token;h.authenticated=!0;f.set("authToken",h.token);h.setHeader();b.$broadcast("auth:statusChange");return a},function(a){h.token="";h.authenticated=!1;f.remove("authToken");
return d.reject(a)});return k};this.logout=function(){var a=c.post(e.backend+"/api/auth/logout/",{}),g=this;a.then(function(a){g.authenticated=!1;g.token="";f.remove("authToken");g.setHeader();b.$broadcast("auth:statusChange");return a},function(a){g.authenticated=!0;return d.reject(a)});return a};this.getToken=function(){if(this.authenticated)return this.token;var a=f.get("authToken");return null!=a?(this.authenticated=!0,this.token=a):!1};this.setHeader=function(){var a=this.getToken();c.defaults.headers.common.Authorization=
0!=a?"Token "+a:null};this.purgeToken=function(){f.remove("authToken")};this.getAuthStatus=function(){if(this.loaded&&!this.error)return d(function(a,b){a(this.user)});var a=c.get(e.backend+"/api/auth/me/"),b=this;a.then(function(a){b.user=a;b.loaded=!0;b.error=!1;return a},function(a){b.loaded=!0;b.error=!0;return d.reject(a)});return a}}]);var authFormApp=angular.module("descant.directives.authforms",["descant.config","descant.services.tokenservice"]);
authFormApp.directive("loginBox",["tokenService","$location",function(c,d){return{restrict:"E",templateUrl:"templates/users/login-box.html",controller:function(){this.login=function(b,e){c.login(b,e).then(function(b){d.path("/")},function(b){alert("Invalid user/password!")})}},controllerAs:"loginCtrl"}}]);
authFormApp.directive("registerBox",["$location",function(c){return{restrict:"E",templateUrl:"templates/users/register-box.html",controller:["$http","descantConfig",function(d,b){this.register=function(e,f,a){e=d.post(b.backend+"/api/auth/register/",{email:f,username:e,password:a});e.success(function(a){c.path("/registered")});e.error(function(a){alert("There was an error while trying to register.")})}}],controllerAs:"registerCtrl"}}]);
var authMiscApp=angular.module("descant.directives.authmisc",["descant.services.tokenservice"]);authMiscApp.directive("logout",["tokenService","$location",function(c,d){return{restrict:"E",template:"",controller:function(b){c.logout().then(function(c){b.path("/")},function(b){alert("Cannot log out.");c.purgeToken()})}}}]);authMiscApp.directive("emitToken",["tokenService",function(c){return{restrict:"E",template:"",controller:function(){c.setHeader()}}}]);
var authApp=angular.module("descant.directives.authstatus",["descant.config","descant.services.tokenservice"]);
authApp.directive("authStatus",["$http","tokenService","descantConfig",function(c,d,b){return{restrict:"E",templateUrl:"templates/users/auth-status.html",controller:["$http","$scope","tokenService",function(b,c,a){this.tryAuth=function(){var b=this;a.getAuthStatus().then(function(a){b.loaded=!0;b.error=!1;b.user=a.data},function(a){b.loaded=!0;b.error=!0})};c.tokenServ=a;var d=this;c.$on("auth:statusChange",function(b,c){a.loaded=!1;d.tryAuth()});d.tryAuth()}],controllerAs:"auth"}}]);
var navApp=angular.module("descant.directives.navbtn",[]);navApp.directive("navBtn",function(){return{restrict:"E",require:"^routeUrl",scope:{routeUrl:"@",routeName:"@",routeIcon:"@"},templateUrl:"templates/nav/nav-btn.html",controller:["$scope","$location",function(c,d){c.isActive=function(b){return b===d.path()}}],controllerAs:"navCtrl"}});var newPostApp=angular.module("descant.directives.newpost",["descant.config","descant.services.tokenservice"]);
newPostApp.directive("newPostBox",["$location",function(c){return{restrict:"E",templateUrl:"templates/posts/new-post-box.html",controller:["tokenService","$rootScope","$http","descantConfig",function(d,b,e,f){this.submitting=!1;this.auth=d.authenticated;var a=this;b.$on("auth:statusChange",function(){a.auth=d.authenticated});this.showNTP=!1;this.toggleNTP=function(){this.showNTP=1==this.showNTP?!1:!0};this.addReply=function(a,d){this.submitting=!0;var k=this;e.post(f.backend+"/api/v0.1/topics/"+d+
"/replies/",{contents:a}).success(function(a){k.submitting=!1;c.path("/topic/"+d);k.toggleNTP();b.$broadcast("topic:refresh")}).error(function(a){k.submitting=!1;alert("Error!")})}}],controllerAs:"newPostCtrl"}}]);var newTopicApp=angular.module("descant.directives.newtopic",["descant.config","descant.services.tokenservice"]);
newTopicApp.directive("newTopicBox",["$location",function(c){return{restrict:"E",templateUrl:"templates/topics/new-topic-box.html",controller:["tokenService","tagService","$rootScope","$http","descantConfig",function(d,b,e,f,a){this.auth=d.authenticated;this.submitting=!1;var g=this;e.$on("auth:statusChange",function(){g.auth=d.authenticated});this.showNTP=!1;this.toggleNTP=function(){this.showNTP=1==this.showNTP?!1:!0};this.addTopic=function(b,d,g){this.submitting=!0;var l;for(l=0;l<g.length;l++)g[l]=
parseInt(g[l].id);var m=this;f.post(a.backend+"/api/v0.1/topics/",{title:b,contents:d,tag_ids:g}).success(function(a){m.submitting=!1;c.path("/topics");m.toggleNTP();e.$broadcast("topics:refresh")}).error(function(a){m.submitting=!1;alert("Error!")})};this.loadTags=function(){return b.getAllTags()}}],controllerAs:"newTopicCtrl"}}]);tagApp=angular.module("descant.directives.taglist",["descant.config","descant.services.tagservice"]);
tagApp.directive("tagList",["$location","tagService",function(c,d){return{restrict:"E",templateUrl:"templates/topics/tag-list.html",controller:["$rootScope","$http","descantConfig",function(b,c,f){this.showTags=!1;this.toggleBox=function(){this.showTags=1==this.showTags?!1:!0};var a=this;this.updateList=function(){a.list=d.getAllTags().then(function(b){a.list=b})};this.updateList()}],controllerAs:"tagCtrl"}}]);var topicListApp=angular.module("descant.directives.topiclist",["descant.config"]);
topicListApp.directive("topicList",["descantConfig",function(c){return{restrict:"E",templateUrl:"templates/topics/topic-list.html",scope:{url:"@"},controller:["$http","$scope","$interval","$rootScope",function(d,b,e,f){var a=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!a.busy&&!a.end){a.busy=!0;var e=d.get(c.backend+b.url+"?limit="+a.limit.toString()+"&offset="+a.offset.toString());e.success(function(b){if(0==b.results.length)a.end=!0;else{for(var c=
b.results,d=0;d<c.length;d++)a.list.push(c[d]);a.offset+=b.results.length;a.busy=!1}});e.error(function(b){a.busy=!1;a.end=!0})}};this.refreshList=function(){a.busy=!0;a.end=!1;var e=d.get(c.backend+b.url+"?limit="+a.offset.toString()+"&offset=0");e.success(function(b){0==b.results.length?a.end=!0:(a.list=b.results,a.busy=!1)});e.error(function(b){a.busy=!1;a.end=!0})};this.stopRefreshList=e(this.refreshList,45E3);f.$on("topics:refresh",function(){a.refreshList()});f.$on("$destroy",function(){e.cancel(a.stopRefreshList)})}],
controllerAs:"topics"}}]);var topicTagsApp=angular.module("angular.directives.topictags",["descant.services.tagservice"]);tagApp.directive("topicTags",["tagService",function(c){return{restrict:"E",templateUrl:"templates/topics/topic-tags.html",scope:{tagItems:"="},controller:["$scope",function(d){this.tags=[];this.updateTags=function(){var b,e=this;for(b=0;b<d.tagItems.length;b++)c.getTagInfo(parseInt(d.tagItems[b])).then(function(b){null!=b&&e.tags.push(b)})};this.updateTags()}],controllerAs:"tags"}}]);
var topicViewApp=angular.module("descant.directives.topicview",["descant.config","descant.filters.html"]);
topicViewApp.directive("topicFirstpost",["descantConfig",function(c){return{restrict:"E",templateUrl:"templates/topics/topic-firstpost.html",controller:["$http","$scope","$location","tagService","tokenService",function(d,b,e,f,a){this.editing=!1;var g=this;g.loaded=!1;var h=d.get(c.backend+"/api/v0.1/topics/"+b.topicId+"/");h.success(function(d){g.post=d;g.loaded=!0;document.title=g.post.title+" | "+c.forumName;b.user=null!=a.user?a.user.data.id:-1});h.error(function(a){g.loaded=!0;g.error=!0});this.edit=
function(){this.editing=!this.editing;b.tag_ids_edited=[];b.contents_edited=g.post.contents;b.title_edited=g.post.title;for(var a=0;a<g.post.tag_ids;a++)f.getTagInfo(g.post.tag_ids[a]).then(function(a){null!=a&&b.tag_ids_edited.push(a)})};this.editSubmit=function(){for(var a=b.tag_ids_edited,e=0;e<a.length;e++)a[e]=parseInt(a[e].id);var g=this;d.put(c.backend+"/api/v0.1/topics/"+b.topicId+"/",{title:b.title_edited,contents:b.contents_edited,tag_ids:a}).success(function(a){g.edit()})};this.deleteObj=
function(){d["delete"](c.backend+"/api/v0.1/topics/"+b.topicId+"/").success(function(a){e.path("/")})};this.loadTags=function(){return f.getAllTags()}}],controllerAs:"topic"}}]);
topicViewApp.directive("postList",["descantConfig",function(c){return{restrict:"E",templateUrl:"templates/posts/reply-list.html",scope:{url:"@"},controller:["$http","$interval","$rootScope","$scope",function(d,b,e,f){var a=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!a.busy&&!a.end){a.busy=!0;var b=d.get(c.backend+f.url+"?limit="+a.limit.toString()+"&offset="+a.offset.toString());b.success(function(b){if(0==b.results.length)a.end=!0;else{for(var c=
b.results,d=0;d<c.length;d++)a.list.push(c[d]);a.offset+=b.results.length;a.busy=!1}});b.error(function(b){a.busy=!1;a.end=!0})}};this.refreshList=function(){a.busy=!0;a.end=!1;var b=d.get(c.backend+f.url+"?limit="+a.offset.toString()+"&offset=0");b.success(function(b){0==b.results.length?a.end=!0:(a.list=b.results,a.busy=!1)});b.error(function(b){a.busy=!1;a.end=!0})};this.stopRefreshList=b(this.refreshList,45E3);e.$on("topic:refresh",function(){a.refreshList()});this.destroy=function(){b.cancel(a.stopRefreshList)};
e.$on("$destroy",function(){a.destroy()});e.$on("$locationChangeSuccess",function(){a.destroy()})}],controllerAs:"posts"}}]);var userListApp=angular.module("descant.directives.userlist",["descant.config"]);
userListApp.directive("userList",["descantConfig",function(c){return{restrict:"E",templateUrl:"templates/users/user-list.html",controller:["$http",function(d){var b=this;d=d.get(c.backend+"/api/v0.1/users/");d.success(function(c){b.list=c;b.loaded=!0});d.error(function(c){b.loaded=!0;b.error=!0})}],controllerAs:"users"}}]);var userStatsApp=angular.module("descant.directives.userstats",["descant.config"]);
userListApp.directive("userStats",["descantConfig",function(c){return{restrict:"E",scope:{userId:"@"},templateUrl:"templates/users/user-stats.html",controller:["$http","$scope",function(d,b){var e=this,f=d.get(c.backend+"/api/v0.1/users/"+b.userId+"/");f.success(function(a){e.user=a;e.loaded=!0});f.error(function(a){e.loaded=!0;e.error=!0})}],controllerAs:"userCtrl"}}]);var controllerApp=angular.module("descant.controllers.routing",[]);
app.controller("PostViewController",["$scope","$routeParams",function(c,d){c.topicId=d.topicId}]);app.controller("UserViewController",["$scope","$location","$routeParams",function(c,d,b){-1!=b.userId?c.userId=b.userId:d.path("/users")}]);app.controller("TagTopicViewController",["$scope","$routeParams",function(c,d){c.tagId=d.tagId}]);
app.controller("ActivateController",["$http","descantConfig","$location","$routeParams",function(c,d,b,e){c=c.post(d.backend+"/api/auth/activate/",{uid:e.uid,token:e.token});c.success(function(c){b.path("/login")});c.error(function(b){alert("Error while activating account!")})}]);var htmlApp=angular.module("descant.filters.html",[]);app.filter("html",["$sce",function(c){return function(d){return c.trustAsHtml(d)}}]);
