var app=angular.module("descant","ngAnimate ngRoute ngTagsInput relativeDate infinite-scroll descant.config descant.services.tokenservice descant.directives.authforms descant.directives.authmisc descant.directives.authstatus descant.directives.navbtn descant.directives.newpost descant.directives.newtopic descant.directives.taglist descant.directives.topiclist descant.directives.topicview descant.directives.topicview descant.directives.userlist".split(" "));
app.config(["$routeProvider","$locationProvider",function(d,c){d.when("/",{title:"Home",templateUrl:"pages/topics.html"}).when("/topics",{title:"Topics",templateUrl:"pages/topics.html"}).when("/users",{title:"Users",templateUrl:"pages/users.html"}).when("/admin",{title:"Administration",templateUrl:"pages/admin.html"}).when("/topic/:topicId",{title:"Topic",templateUrl:"pages/post-view.html",controller:"PostViewController"}).when("/topics/:tagId",{title:"Topics",templateUrl:"pages/tag-topics.html",
controller:"TagTopicViewController"}).when("/chat",{title:"Chat",templateUrl:"pages/chat.html"}).when("/login",{title:"Log in",templateUrl:"pages/login.html"}).when("/register",{title:"Register",templateUrl:"pages/register.html"}).when("/logout",{title:"Log out",templateUrl:"pages/logout.html"}).when("/activate",{title:"Account Activation",template:"",controller:"ActivateController"}).when("/registered",{title:"Registration Succeeded!",templateUrl:"pages/registration-done.html"}).when("/404",{title:"Not Found",
templateUrl:"pages/404.html"}).otherwise("/404")}]);app.directive("chatBox",function(){return{restrict:"E",templateUrl:"templates/chat/chat-box.html"}});app.directive("adminPanel",function(){return{restrict:"E",templateUrl:"templates/admin/admin-panel.html"}});app.run(["$rootScope","$route","$timeout","$window","descantConfig",function(d,c,f,e,b){d.$on("$routeChangeSuccess",function(){f(function(){e.scrollTo(0,0)},500);document.title=c.current.title+" | "+b.forumName})}]);
angular.module("descant.config",[]).constant("descantConfig",{backend:"//django-descant.rhcloud.com",version:.1,forumName:"Descant Demo Forum"});var tagApp=angular.module("descant.services.tagservice",["descant.config"]);
tagApp.service("tagService",["$http","$q","$rootScope","descantConfig",function(d,c,f,e){this.tags=[];this.fetched=!1;this.getTagInfo=function(b){var a=this;if(!this.fetched)return this.fetch().then(function(d){return a.tags[b]});var d=this.tags[b];return c(function(a,b){a(d)})};this.getAllTags=function(){if(!this.fetched){var b=this;return this.fetch().then(function(a){return b.tags})}var a=this.tags;return c(function(b,d){b(a)})};this.fetch=function(){var b=this;return d.get(e.backend+"/api/v0.1/tags/").then(function(a){b.tags=
a.data;b.fetched=!0;return a.data},function(a){b.fetched=!0;return c.reject(a)})}}]);var tokenApp=angular.module("descant.services.tokenservice",["descant.config","LocalStorageModule"]);
tokenApp.service("tokenService",["$http","$q","$rootScope","descantConfig","localStorageService",function(d,c,f,e,b){this.authenticated=!1;this.token="";this.login=function(a,k){this.authenticated=!1;this.token="";var h=this,g=d.post(e.backend+"/api/auth/login/",{username:a,password:k});g.then(function(a){h.token=a.data.auth_token;h.authenticated=!0;b.set("authToken",h.token);h.setHeader();f.$broadcast("auth:statusChange");return a},function(a){h.token="";h.authenticated=!1;b.remove("authToken");
return c.reject(a)});return g};this.logout=function(){var a=d.post(e.backend+"/api/auth/logout/",{}),k=this;a.then(function(a){k.authenticated=!1;k.token="";b.remove("authToken");k.setHeader();f.$broadcast("auth:statusChange");return a},function(a){k.authenticated=!0;return c.reject(a)});return a};this.getToken=function(){if(this.authenticated)return this.token;var a=b.get("authToken");return null!=a?(this.authenticated=!0,this.token=a):!1};this.setHeader=function(){var a=this.getToken();d.defaults.headers.common.Authorization=
0!=a?"Token "+a:null};this.purgeToken=function(){b.remove("authToken")}}]);var authFormApp=angular.module("descant.directives.authforms",["descant.config","descant.services.tokenservice"]);authFormApp.directive("loginBox",["tokenService","$location",function(d,c){return{restrict:"E",templateUrl:"templates/users/login-box.html",controller:function(){this.login=function(f,e){d.login(f,e).then(function(b){c.path("/")},function(b){alert("Invalid user/password!")})}},controllerAs:"loginCtrl"}}]);
authFormApp.directive("registerBox",["$location",function(d){return{restrict:"E",templateUrl:"templates/users/register-box.html",controller:["$http","descantConfig",function(c,f){this.register=function(e,b,a){e=c.post(f.backend+"/api/auth/register/",{email:b,username:e,password:a});e.success(function(a){d.path("/registered")});e.error(function(a){alert("There was an error while trying to register.")})}}],controllerAs:"registerCtrl"}}]);
var authMiscApp=angular.module("descant.directives.authmisc",["descant.services.tokenservice"]);authMiscApp.directive("logout",["tokenService","$location",function(d,c){return{restrict:"E",template:"",controller:function(c){d.logout().then(function(d){c.path("/")},function(c){alert("Cannot log out.");d.purgeToken()})}}}]);authMiscApp.directive("emitToken",["tokenService",function(d){return{restrict:"E",template:"",controller:function(){d.setHeader()}}}]);
var authApp=angular.module("descant.directives.authstatus",["descant.config","descant.services.tokenservice"]);
authApp.directive("authStatus",["$http","tokenService","descantConfig",function(d,c,f){return{restrict:"E",templateUrl:"templates/users/auth-status.html",controller:["$http","$scope","tokenService",function(d,b,a){this.tryAuth=function(){var a=d.get(f.backend+"/api/auth/me/");a.success(function(a){c.user=a;c.loaded=!0;c.error=!1});a.error(function(a){c.loaded=!0;c.error=!0})};b.tokenServ=a;var c=this;b.$on("auth:statusChange",function(a,b){c.tryAuth()});c.tryAuth()}],controllerAs:"auth"}}]);
var navApp=angular.module("descant.directives.navbtn",[]);navApp.directive("navBtn",function(){return{restrict:"E",require:"^routeUrl",scope:{routeUrl:"@",routeName:"@",routeIcon:"@"},templateUrl:"templates/nav/nav-btn.html",controller:["$scope","$location",function(d,c){d.isActive=function(d){return d===c.path()}}],controllerAs:"navCtrl"}});var newPostApp=angular.module("descant.directives.newpost",["descant.config","descant.services.tokenservice"]);
newPostApp.directive("newPostBox",["$location",function(d){return{restrict:"E",templateUrl:"templates/posts/new-post-box.html",controller:["tokenService","$rootScope","$http","descantConfig",function(c,f,e,b){this.auth=c.authenticated;var a=this;f.$on("auth:statusChange",function(){a.auth=c.authenticated});this.showNTP=!1;this.toggleNTP=function(){this.showNTP=1==this.showNTP?!1:!0};this.addReply=function(a,c){var g=this;e.post(b.backend+"/api/v0.1/topics/"+c+"/replies/",{contents:a}).success(function(a){d.path("/topic/"+
c);g.toggleNTP();f.$broadcast("topic:refresh")}).error(function(a){alert("Error adding post.")})}}],controllerAs:"newPostCtrl"}}]);var newTopicApp=angular.module("descant.directives.newtopic",["descant.config","descant.services.tokenservice"]);
newTopicApp.directive("newTopicBox",["$location",function(d){return{restrict:"E",templateUrl:"templates/topics/new-topic-box.html",controller:["tokenService","$rootScope","$http","descantConfig",function(c,f,e,b){this.auth=c.authenticated;var a=this;f.$on("auth:statusChange",function(){a.auth=c.authenticated});this.showNTP=!1;this.toggleNTP=function(){this.showNTP=1==this.showNTP?!1:!0};this.addTopic=function(a,c,g){var l;for(l=0;l<g.length;l++)g[l]=parseInt(g[l].id);var m=this;e.post(b.backend+"/api/v0.1/topics/",
{title:a,contents:c,tag_ids:g}).success(function(a){d.path("/topics");m.toggleNTP();f.$broadcast("topics:refresh")}).error(function(a){alert("Error adding topic.")})};this.loadTags=function(){return e.get(b.backend+"/api/v0.1/tags/")}}],controllerAs:"newTopicCtrl"}}]);tagApp=angular.module("descant.directives.taglist",["descant.config","descant.services.tagservice"]);
tagApp.directive("tagList",["$location","tagService",function(d,c){return{restrict:"E",templateUrl:"templates/topics/tag-list.html",controller:["$rootScope","$http","descantConfig",function(d,e,b){this.showTags=!1;this.toggleBox=function(){this.showTags=1==this.showTags?!1:!0};var a=this;this.updateList=function(){a.list=c.getAllTags().then(function(b){a.list=b})};this.updateList()}],controllerAs:"tagCtrl"}}]);var topicListApp=angular.module("descant.directives.topiclist",["descant.config"]);
topicListApp.directive("topicList",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/topics/topic-list.html",controller:["$http","$interval","$rootScope",function(c,f,e){var b=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!b.busy&&!b.end){b.busy=!0;var a=c.get(d.backend+"/api/v0.1/topics/newestreplies/?limit="+b.limit.toString()+"&offset="+b.offset.toString());a.success(function(a){if(0==a.results.length)b.end=!0;else{for(var c=
a.results,d=0;d<c.length;d++)b.list.push(c[d]);b.offset+=a.results.length;b.busy=!1}});a.error(function(a){b.busy=!1;b.end=!0})}};this.refreshList=function(){b.busy=!0;var a=c.get(d.backend+"/api/v0.1/topics/newestreplies/?limit="+b.offset.toString()+"&offset=0");a.success(function(a){0==a.results.length?b.end=!0:(b.list=a.results,b.busy=!1)});a.error(function(a){b.busy=!1;b.end=!0})};this.stopRefreshList=f(this.refreshList,45E3);e.$on("topics:refresh",function(){b.refreshList()});e.$on("$destroy",
function(){f.cancel(b.stopRefreshList)})}],controllerAs:"topics"}}]);
topicListApp.directive("tagTopicList",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/topics/topic-list.html",scope:{tagId:"@"},controller:["$http","$scope","$interval","$rootScope",function(c,f,e,b){var a=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!a.busy&&!a.end){a.busy=!0;var b=c.get(d.backend+"/api/v0.1/tags/"+f.tagId+"/newestreplies/?limit="+a.limit.toString()+"&offset="+a.offset.toString());b.success(function(b){if(0==
b.results.length)a.end=!0;else{for(var c=b.results,d=0;d<c.length;d++)a.list.push(c[d]);a.offset+=b.results.length;a.busy=!1}});b.error(function(b){a.busy=!1;a.end=!0})}};this.refreshList=function(){a.busy=!0;var b=c.get(d.backend+"/api/v0.1/tags/"+f.tagId+"/newestreplies/?limit="+a.offset.toString()+"&offset=0");b.success(function(b){0==b.results.length?a.end=!0:(a.list=b.results,a.busy=!1)});b.error(function(b){a.busy=!1;a.end=!0})};this.stopRefreshList=e(this.refreshList,45E3);b.$on("topics:refresh",
function(){a.refreshList()});b.$on("$destroy",function(){e.cancel(a.stopRefreshList)})}],controllerAs:"topics"}}]);var topicTagsApp=angular.module("angular.directives.topictags",["descant.services.tagservice"]);
tagApp.directive("topicTags",["tagService",function(d){return{restrict:"E",templateUrl:"templates/topics/topic-tags.html",scope:{tagItems:"="},controller:["$scope",function(c){this.tags=[];this.updateTags=function(){var f,e=this;for(f=0;f<c.tagItems.length;f++)d.getTagInfo(parseInt(c.tagItems[f])).then(function(b){null!=b&&e.tags.push(b)})};this.updateTags()}],controllerAs:"tags"}}]);var topicViewApp=angular.module("descant.directives.topicview",["descant.config"]);
topicViewApp.directive("topicFirstpost",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/topics/topic-firstpost.html",controller:["$http","$scope",function(c,f){var e=this;e.loaded=!1;var b=c.get(d.backend+"/api/v0.1/topics/"+f.topicId+"/");b.success(function(a){e.post=a;e.loaded=!0;document.title=e.post.title+" | "+d.forumName});b.error(function(a){e.loaded=!0;e.error=!0})}],controllerAs:"topic"}}]);
topicViewApp.directive("postList",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/posts/reply-list.html",controller:["$http","$interval","$rootScope","$scope",function(c,f,e,b){var a=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!a.busy&&!a.end){a.busy=!0;var e=c.get(d.backend+"/api/v0.1/topics/"+b.topicId+"/replies/?limit="+a.limit.toString()+"&offset="+a.offset.toString());e.success(function(b){if(0==b.results.length)a.end=
!0;else{for(var c=b.results,d=0;d<c.length;d++)a.list.push(c[d]);a.offset+=b.results.length;a.busy=!1}});e.error(function(b){a.busy=!1;a.end=!0})}};this.refreshList=function(){a.busy=!0;a.end=!1;var e=c.get(d.backend+"/api/v0.1/topics/"+b.topicId+"/replies/?limit="+a.offset.toString()+"&offset=0");e.success(function(b){0==b.results.length?a.end=!0:(a.list=b.results,a.busy=!1)});e.error(function(b){a.busy=!1;a.end=!0})};this.stopRefreshList=f(this.refreshList,45E3);e.$on("topic:refresh",function(){a.refreshList()});
this.destroy=function(){f.cancel(a.stopRefreshList)};e.$on("$destroy",function(){a.destroy()});e.$on("$locationChangeSuccess",function(){a.destroy()})}],controllerAs:"posts"}}]);var userListApp=angular.module("descant.directives.userlist",["descant.config"]);
userListApp.directive("userList",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/users/user-list.html",controller:["$http",function(c){var f=this;c=c.get(d.backend+"/api/v0.1/users/");c.success(function(c){f.list=c;f.loaded=!0});c.error(function(c){f.loaded=!0;f.error=!0})}],controllerAs:"users"}}]);var controllerApp=angular.module("descant.controllers.routing",[]);app.controller("PostViewController",["$scope","$routeParams",function(d,c){d.topicId=c.topicId}]);
app.controller("TagTopicViewController",["$scope","$routeParams",function(d,c){d.tagId=c.tagId}]);app.controller("ActivateController",["$http","descantConfig","$location","$routeParams",function(d,c,f,e){d=d.post(c.backend+"/api/auth/activate/",{uid:e.uid,token:e.token});d.success(function(b){f.path("/login")});d.error(function(b){alert("Error while activating account!")})}]);
