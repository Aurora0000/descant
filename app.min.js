var app=angular.module("descant","ngAnimate ngRoute ngTagsInput relativeDate infinite-scroll descant.config descant.services.tokenservice descant.directives.authforms descant.directives.authmisc descant.directives.authstatus descant.directives.navbtn descant.directives.newpost descant.directives.newtopic descant.directives.taglist descant.directives.topiclist descant.directives.topicview descant.directives.topicview descant.directives.userlist".split(" "));
app.config(["$routeProvider","$locationProvider",function(d,b){d.when("/",{title:"Home",templateUrl:"pages/topics.html"}).when("/topics",{title:"Topics",templateUrl:"pages/topics.html"}).when("/users",{title:"Users",templateUrl:"pages/users.html"}).when("/admin",{title:"Administration",templateUrl:"pages/admin.html"}).when("/topic/:topicId",{title:"Topic",templateUrl:"pages/post-view.html",controller:"PostViewController"}).when("/topics/:tagId",{title:"Topics",templateUrl:"pages/tag-topics.html",
controller:"TagTopicViewController"}).when("/chat",{title:"Chat",templateUrl:"pages/chat.html"}).when("/login",{title:"Log in",templateUrl:"pages/login.html"}).when("/register",{title:"Register",templateUrl:"pages/register.html"}).when("/logout",{title:"Log out",templateUrl:"pages/logout.html"}).when("/activate",{title:"Account Activation",template:"",controller:"ActivateController"}).when("/registered",{title:"Registration Succeeded!",templateUrl:"pages/registration-done.html"}).when("/404",{title:"Not Found",
templateUrl:"pages/404.html"}).otherwise("/404")}]);app.directive("chatBox",function(){return{restrict:"E",templateUrl:"templates/chat/chat-box.html"}});app.directive("adminPanel",function(){return{restrict:"E",templateUrl:"templates/admin/admin-panel.html"}});app.run(["$rootScope","$route","$timeout","$window","descantConfig",function(d,b,f,e,c){d.$on("$routeChangeSuccess",function(){f(function(){e.scrollTo(0,0)},500);document.title=b.current.title+" | "+c.forumName})}]);
angular.module("descant.config",[]).constant("descantConfig",{backend:"//django-descant.rhcloud.com",version:.1,forumName:"Descant Demo Forum"});var tokenApp=angular.module("descant.services.tokenservice",["descant.config","LocalStorageModule"]);
tokenApp.service("tokenService",["$http","$q","$rootScope","descantConfig","localStorageService",function(d,b,f,e,c){this.authenticated=!1;this.token="";this.login=function(a,h){this.authenticated=!1;this.token="";var k=this,g=d.post(e.backend+"/api/auth/login/",{username:a,password:h});g.then(function(a){k.token=a.data.auth_token;k.authenticated=!0;c.set("authToken",k.token);k.setHeader();f.$broadcast("auth:statusChange");return a},function(a){k.token="";k.authenticated=!1;c.remove("authToken");
return b.reject(a)});return g};this.logout=function(){var a=d.post(e.backend+"/api/auth/logout/",{}),h=this;a.then(function(a){h.authenticated=!1;h.token="";c.remove("authToken");h.setHeader();f.$broadcast("auth:statusChange");return a},function(a){h.authenticated=!0;return b.reject(a)});return a};this.getToken=function(){if(this.authenticated)return this.token;var a=c.get("authToken");return null!=a?(this.authenticated=!0,this.token=a):!1};this.setHeader=function(){var a=this.getToken();d.defaults.headers.common.Authorization=
0!=a?"Token "+a:null};this.purgeToken=function(){c.remove("authToken")}}]);var authFormApp=angular.module("descant.directives.authforms",["descant.config","descant.services.tokenservice"]);authFormApp.directive("loginBox",["tokenService","$location",function(d,b){return{restrict:"E",templateUrl:"templates/users/login-box.html",controller:function(){this.login=function(f,e){d.login(f,e).then(function(c){b.path("/")},function(c){alert("Invalid user/password!")})}},controllerAs:"loginCtrl"}}]);
authFormApp.directive("registerBox",["$location",function(d){return{restrict:"E",templateUrl:"templates/users/register-box.html",controller:["$http","descantConfig",function(b,f){this.register=function(e,c,a){e=b.post(f.backend+"/api/auth/register/",{email:c,username:e,password:a});e.success(function(a){d.path("/registered")});e.error(function(a){alert("There was an error while trying to register.")})}}],controllerAs:"registerCtrl"}}]);
var authMiscApp=angular.module("descant.directives.authmisc",["descant.services.tokenservice"]);authMiscApp.directive("logout",["tokenService","$location",function(d,b){return{restrict:"E",template:"",controller:function(b){d.logout().then(function(d){b.path("/")},function(b){alert("Cannot log out.");d.purgeToken()})}}}]);authMiscApp.directive("emitToken",["tokenService",function(d){return{restrict:"E",template:"",controller:function(){d.setHeader()}}}]);
var authApp=angular.module("descant.directives.authstatus",["descant.config","descant.services.tokenservice"]);
authApp.directive("authStatus",["$http","tokenService","descantConfig",function(d,b,f){return{restrict:"E",templateUrl:"templates/users/auth-status.html",controller:["$http","$scope","tokenService",function(d,c,a){this.tryAuth=function(){var a=d.get(f.backend+"/api/auth/me/");a.success(function(a){b.user=a;b.loaded=!0;b.error=!1});a.error(function(a){b.loaded=!0;b.error=!0})};c.tokenServ=a;var b=this;c.$on("auth:statusChange",function(a,c){b.tryAuth()});b.tryAuth()}],controllerAs:"auth"}}]);
var navApp=angular.module("descant.directives.navbtn",[]);navApp.directive("navBtn",function(){return{restrict:"E",require:"^routeUrl",scope:{routeUrl:"@",routeName:"@",routeIcon:"@"},templateUrl:"templates/nav/nav-btn.html",controller:["$scope","$location",function(d,b){d.isActive=function(d){return d===b.path()}}],controllerAs:"navCtrl"}});var newPostApp=angular.module("descant.directives.newpost",["descant.config","descant.services.tokenservice"]);
newPostApp.directive("newPostBox",["$location",function(d){return{restrict:"E",templateUrl:"templates/posts/new-post-box.html",controller:["tokenService","$rootScope","$http","descantConfig",function(b,f,e,c){this.auth=b.authenticated;var a=this;f.$on("auth:statusChange",function(){a.auth=b.authenticated});this.showNTP=!1;this.toggleNTP=function(){this.showNTP=1==this.showNTP?!1:!0};this.addReply=function(a,b){var g=this;e.post(c.backend+"/api/v0.1/topics/"+b+"/replies/",{contents:a}).success(function(a){d.path("/topic/"+
b);g.toggleNTP();f.$broadcast("topic:refresh")}).error(function(a){alert("Error adding post.")})}}],controllerAs:"newPostCtrl"}}]);var newTopicApp=angular.module("descant.directives.newtopic",["descant.config","descant.services.tokenservice"]);
newTopicApp.directive("newTopicBox",["$location",function(d){return{restrict:"E",templateUrl:"templates/topics/new-topic-box.html",controller:["tokenService","$rootScope","$http","descantConfig",function(b,f,e,c){this.auth=b.authenticated;var a=this;f.$on("auth:statusChange",function(){a.auth=b.authenticated});this.showNTP=!1;this.toggleNTP=function(){this.showNTP=1==this.showNTP?!1:!0};this.addTopic=function(a,b,g){var l;for(l=0;l<g.length;l++)g[l]=parseInt(g[l].id);var m=this;e.post(c.backend+"/api/v0.1/topics/",
{title:a,contents:b,tag_ids:g}).success(function(a){d.path("/topics");m.toggleNTP();f.$broadcast("topics:refresh")}).error(function(a){alert("Error adding topic.")})};this.loadTags=function(){return e.get(c.backend+"/api/v0.1/tags/")}}],controllerAs:"newTopicCtrl"}}]);var tagApp=angular.module("descant.directives.taglist",["descant.config"]);
tagApp.directive("tagList",["$location",function(d){return{restrict:"E",templateUrl:"templates/topics/tag-list.html",controller:["$rootScope","$http","descantConfig",function(b,d,e){this.showTags=!1;this.toggleBox=function(){this.showTags=1==this.showTags?!1:!0};var c=this;this.updateList=function(){d.get(e.backend+"/api/v0.1/tags/").success(function(a){c.list=a})};this.updateList()}],controllerAs:"tagCtrl"}}]);var topicListApp=angular.module("descant.directives.topiclist",["descant.config"]);
topicListApp.directive("topicList",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/topics/topic-list.html",controller:["$http","$interval","$rootScope",function(b,f,e){var c=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!c.busy&&!c.end){c.busy=!0;var a=b.get(d.backend+"/api/v0.1/topics/newestreplies/?limit="+c.limit.toString()+"&offset="+c.offset.toString());a.success(function(a){if(0==a.results.length)c.end=!0;else{for(var b=
a.results,d=0;d<b.length;d++)c.list.push(b[d]);c.offset+=a.results.length;c.busy=!1}});a.error(function(a){c.busy=!1;c.end=!0})}};this.refreshList=function(){c.busy=!0;var a=b.get(d.backend+"/api/v0.1/topics/newestreplies/?limit="+c.offset.toString()+"&offset=0");a.success(function(a){0==a.results.length?c.end=!0:(c.list=a.results,c.busy=!1)});a.error(function(a){c.busy=!1;c.end=!0})};this.stopRefreshList=f(this.refreshList,45E3);e.$on("topics:refresh",function(){c.refreshList()});e.$on("$destroy",
function(){f.cancel(c.stopRefreshList)})}],controllerAs:"topics"}}]);
topicListApp.directive("tagTopicList",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/topics/topic-list.html",scope:{tagId:"@"},controller:["$http","$scope","$interval","$rootScope",function(b,f,e,c){var a=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!a.busy&&!a.end){a.busy=!0;var c=b.get(d.backend+"/api/v0.1/tags/"+f.tagId+"/newestreplies/?limit="+a.limit.toString()+"&offset="+a.offset.toString());c.success(function(b){if(0==
b.results.length)a.end=!0;else{for(var d=b.results,c=0;c<d.length;c++)a.list.push(d[c]);a.offset+=b.results.length;a.busy=!1}});c.error(function(b){a.busy=!1;a.end=!0})}};this.refreshList=function(){a.busy=!0;var c=b.get(d.backend+"/api/v0.1/tags/"+f.tagId+"/newestreplies/?limit="+a.offset.toString()+"&offset=0");c.success(function(b){0==b.results.length?a.end=!0:(a.list=b.results,a.busy=!1)});c.error(function(b){a.busy=!1;a.end=!0})};this.stopRefreshList=e(this.refreshList,45E3);c.$on("topics:refresh",
function(){a.refreshList()});c.$on("$destroy",function(){e.cancel(a.stopRefreshList)})}],controllerAs:"topics"}}]);var topicViewApp=angular.module("descant.directives.topicview",["descant.config"]);
topicViewApp.directive("topicFirstpost",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/topics/topic-firstpost.html",controller:["$http","$scope",function(b,f){var e=this;e.loaded=!1;var c=b.get(d.backend+"/api/v0.1/topics/"+f.topicId+"/");c.success(function(a){e.post=a;e.loaded=!0;document.title=e.post.title+" | "+d.forumName});c.error(function(a){e.loaded=!0;e.error=!0})}],controllerAs:"topic"}}]);
topicViewApp.directive("postList",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/posts/reply-list.html",controller:["$http","$interval","$rootScope","$scope",function(b,f,e,c){var a=this;this.list=[];this.busy=!1;this.offset=0;this.limit=15;this.end=!1;this.updateList=function(){if(!a.busy&&!a.end){a.busy=!0;var e=b.get(d.backend+"/api/v0.1/topics/"+c.topicId+"/replies/?limit="+a.limit.toString()+"&offset="+a.offset.toString());e.success(function(b){if(0==b.results.length)a.end=
!0;else{for(var c=b.results,d=0;d<c.length;d++)a.list.push(c[d]);a.offset+=b.results.length;a.busy=!1}});e.error(function(b){a.busy=!1;a.end=!0})}};this.refreshList=function(){a.busy=!0;a.end=!1;var e=b.get(d.backend+"/api/v0.1/topics/"+c.topicId+"/replies/?limit="+a.offset.toString()+"&offset=0");e.success(function(b){0==b.results.length?a.end=!0:(a.list=b.results,a.busy=!1)});e.error(function(b){a.busy=!1;a.end=!0})};this.stopRefreshList=f(this.refreshList,45E3);e.$on("topic:refresh",function(){a.refreshList()});
this.destroy=function(){f.cancel(a.stopRefreshList)};e.$on("$destroy",function(){a.destroy()});e.$on("$locationChangeSuccess",function(){a.destroy()})}],controllerAs:"posts"}}]);var userListApp=angular.module("descant.directives.userlist",["descant.config"]);
userListApp.directive("userList",["descantConfig",function(d){return{restrict:"E",templateUrl:"templates/users/user-list.html",controller:["$http",function(b){var f=this;b=b.get(d.backend+"/api/v0.1/users/");b.success(function(b){f.list=b;f.loaded=!0});b.error(function(b){f.loaded=!0;f.error=!0})}],controllerAs:"users"}}]);var controllerApp=angular.module("descant.controllers.routing",[]);app.controller("PostViewController",["$scope","$routeParams",function(d,b){d.topicId=b.topicId}]);
app.controller("TagTopicViewController",["$scope","$routeParams",function(d,b){d.tagId=b.tagId}]);app.controller("ActivateController",["$http","descantConfig","$location","$routeParams",function(d,b,f,e){d=d.post(b.backend+"/api/auth/activate/",{uid:e.uid,token:e.token});d.success(function(b){f.path("/login")});d.error(function(b){alert("Error while activating account!")})}]);
